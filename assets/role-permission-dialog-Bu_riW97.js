const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Q3P-rwBo.js","assets/index-1eFqJOOG.css"])))=>i.map(i=>d[i]);
var e=(e,t,s)=>new Promise((a,l)=>{var o=e=>{try{n(s.next(e))}catch(t){l(t)}},i=e=>{try{n(s.throw(e))}catch(t){l(t)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,i);n((s=s.apply(e,t)).next())});import{d as t,v as s,c as a,a as l,w as o,y as i,f as n,z as r,h as u,p as d,u as m,e as c,k as p,i as v,m as y,l as f,I as h,N as j,dW as x,dX as g,aF as k,aN as _,as as b,aq as w,dU as D,n as I}from"./index-Q3P-rwBo.js";import{E as W}from"./el-dialog-DSZOKVfF.js";import"./el-overlay-BNvnZVrW.js";import{E as R}from"./el-button-CEOXYcAP.js";/* empty css                *//* empty css                    *//* empty css                */import{s as S,a as C}from"./role-CieD1rRU.js";import{E}from"./index-D1q65U0P.js";import{_ as F}from"./plugin-vue_export-helper-BCo6x5W8.js";import"./index-NgMJylyR.js";import"./vnode-DaF8TtDL.js";import"./index-DnxPVI-a.js";import"./scroll-Bn5eNAyQ.js";import"./index-DY7vEF7P.js";import"./aria-Dle50h-X.js";import"./index-C9GIbpAR.js";import"./refs-Cw5r5QN8.js";import"./index-Bw2LRIqh.js";import"./index-CHpuP5IO.js";import"./use-form-common-props-CRk7VbzP.js";import"./event-BwRzfsZt.js";import"./token-DWNpOE8r.js";import"./index-fNUsGspI.js";import"./index-elQxurtn.js";const V={class:"menu-permission-content"},L={class:"custom-tree-node"},P={class:"dialog-footer"},U=F(t({__name:"role-permission-dialog",props:{visible:{type:Boolean},roleData:{}},emits:["update:visible","success"],setup(t,{emit:F}){const{t:U}=s(),$=t,K=F,M=a({get:()=>$.visible,set:e=>K("update:visible",e)}),H=l(),N=l(!1),T=l(),X=l([]),q=e=>{var t;const s=(null==(t=e.meta)?void 0:t.title)||e.title||"";return s.startsWith("menus.")||s.startsWith("common.")||s.startsWith("httpMsg.")?U(s):s},z=()=>e(null,null,function*(){var e;if(null==(e=$.roleData)?void 0:e.id)try{const e=yield C($.roleData.id);X.value=(null==e?void 0:e.menuIds)||[],yield I(),H.value&&H.value.setCheckedKeys((null==e?void 0:e.menuIds)||[],!1)}catch(t){}});o(()=>[$.visible,$.roleData],([t])=>{t&&e(null,null,function*(){var e;try{const t=yield D();T.value=t||[],yield I(),(null==(e=$.roleData)?void 0:e.id)&&z()}catch(t){}})},{immediate:!0});const A=()=>e(null,null,function*(){var e,t,s;if(null==(e=$.roleData)?void 0:e.id){N.value=!0;try{const e=(null==(t=H.value)?void 0:t.getCheckedKeys())||[],a=(null==(s=H.value)?void 0:s.getHalfCheckedKeys())||[],l=[...new Set([...e,...a])];yield S($.roleData.id.toString(),l),j.success(U("menus.system.saveSuccess")),M.value=!1,yield B(),K("success")}catch(a){j.error(a.message||U("menus.system.saveFailed"))}finally{N.value=!1}}else j.warning(U("menus.system.selectRole"))}),B=()=>e(null,null,function*(){try{const t=x();if(!t)return;const s=new g,a=yield s.getMenuList();t.reregister(a);const l=k();l.setMenuList(a),l.addRemoveRouteFns(t.getRemoveRouteFns()),_.getInstance().save();const{useWorktabStore:o}=yield b(()=>e(null,null,function*(){const{useWorktabStore:e}=yield import("./index-Q3P-rwBo.js").then(e=>e.ei);return{useWorktabStore:e}}),__vite__mapDeps([0,1]));o().validateWorktabs(w)}catch(t){j.error("刷新菜单失败")}});return(e,t)=>{const s=E,a=R,l=W;return n(),i(l,{modelValue:m(M),"onUpdate:modelValue":t[1]||(t[1]=e=>h(M)?M.value=e:null),title:e.$t("menus.system.menuPermission"),width:"600px","align-center":"","close-on-click-modal":!1},{footer:r(()=>[u("div",P,[d(a,{onClick:t[0]||(t[0]=e=>M.value=!1)},{default:r(()=>[f(y(e.$t("common.cancel")),1)]),_:1}),d(a,{type:"primary",onClick:A,loading:m(N)},{default:r(()=>[f(y(e.$t("menus.system.save")),1)]),_:1},8,["loading"])])]),default:r(()=>[u("div",V,[d(s,{ref_key:"menuTreeRef",ref:H,data:m(T),props:{children:"children"},"node-key":"id","show-checkbox":"","default-expand-all":"","render-after-expand":!1,"check-strictly":!0,style:{height:"400px","overflow-y":"auto"}},{default:r(({node:e,data:t})=>{var s;return[u("span",L,[(null==(s=t.meta)?void 0:s.icon)?(n(),c("i",{key:0,class:v(t.meta.icon),style:{"margin-right":"8px"}},null,2)):p("",!0),u("span",null,y(q(t)),1)])]}),_:1},8,["data"])])]),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-72056965"]]);export{U as default};
