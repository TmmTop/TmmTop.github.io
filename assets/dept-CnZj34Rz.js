var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,o=(t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,a=(e,t)=>{for(var r in t||(t={}))n.call(t,r)&&o(e,r,t[r]);if(s)for(var r of s(t))d.call(t,r)&&o(e,r,t[r]);return e},i=(e,s)=>t(e,r(s)),l=(e,t,r)=>new Promise((s,n)=>{var d=e=>{try{a(r.next(e))}catch(t){n(t)}},o=e=>{try{a(r.throw(e))}catch(t){n(t)}},a=e=>e.done?s(e.value):Promise.resolve(e.value).then(d,o);a((r=r.apply(e,t)).next())});import{dS as c,dT as p}from"./index-tq4TX8ps.js";function u(e){return l(this,null,function*(){const{status:e,deptName:t}={};let r=c.from("sys_dept").select("*");void 0!==e&&(r=r.eq("status",1===e)),t&&(r=r.ilike("dept_name",`%${t}%`));const{data:s,error:n}=yield r.order("sort",{ascending:!0});return n&&p(n.code,"获取部门列表失败"),s?s.map(e=>i(a({},e),{status:e.status?1:0})):s})}function m(e){return l(this,null,function*(){const{status:t,deptName:r}=e||{};let s=c.from("sys_dept").select("*");void 0!==t&&(s=s.eq("status",1===t)),r&&(s=s.ilike("dept_name",`%${r}%`));const{data:n,error:d}=yield s.order("sort",{ascending:!0});if(d&&p(d.code,"获取部门列表失败"),n){return h(n.map(e=>i(a({},e),{status:e.status?1:0})))}return[]})}function f(e){return l(this,null,function*(){const{deptCode:t,deptName:r,parentId:s,orderNum:n,leader:d,phone:o,email:a,status:i,remark:l}=e,{data:u}=yield c.from("sys_dept").select("id").eq("dept_name",r).single();u&&p("0","部门名称已存在");const{data:m,error:f}=yield c.from("sys_dept").insert({dept_code:t,dept_name:r,parent_id:0==s?null:s,sort:n,leader:d,phone:o,email:a,status:i,remark:l}).select("id").single();return!f&&m||p(f.code,"创建部门失败"),{message:"创建部门成功"}})}function y(e,t){return l(this,null,function*(){e||p("0","部门ID不能为空");const{deptCode:r,deptName:s,parentId:n,orderNum:d,leader:o,phone:a,email:i,status:l,remark:u}=t,{data:m,error:f}=yield c.from("sys_dept").select("id, dept_name").eq("id",e).single();if(!f&&m||p(f.code,"部门不存在"),s&&s!==(null==m?void 0:m.dept_name)){const{data:t}=yield c.from("sys_dept").select("id").eq("dept_name",s).neq("id",e).single();t&&p("0","部门名称已存在")}const{error:y}=yield c.from("sys_dept").update({dept_code:r,dept_name:s,parent_id:0==n?null:n,sort:d,leader:o,phone:a,email:i,status:l,remark:u}).eq("id",e);return y&&p(y.code,"更新部门失败"),{message:"更新部门成功"}})}function _(e){return l(this,null,function*(){e||p("0","部门ID不能为空");const{data:t,error:r}=yield c.from("sys_dept").select("id").eq("id",e).single();!r&&t||p(r.code,"部门不存在");const{data:s,error:n}=yield c.from("sys_dept").select("id").eq("parent_id",e);n&&p(n.code,"检查子部门失败");const{data:d,error:o}=yield c.from("sys_user").select("id").eq("dept_id",e);o&&p(o.code,"检查部门用户失败"),d&&d.length>0&&p("0","该部门下存在用户，无法删除");const{error:a}=yield c.from("sys_dept").delete().eq("id",e);return a&&p(a.code,"删除部门失败"),{message:"删除部门成功"}})}function h(e){if(!e||0===e.length)return[];const t=new Map,r=[];return e.forEach(e=>{t.set(e.id,i(a({},e),{children:[]}))}),e.forEach(e=>{const s=t.get(e.id);if("0"===e.parent_id||null===e.parent_id||void 0===e.parent_id)r.push(s);else{const r=t.get(e.parent_id);r&&r.children.push(s)}}),r}export{m as a,h as b,f as c,_ as d,u as g,y as u};
