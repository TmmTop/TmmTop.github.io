var e=Object.defineProperty,l=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(l,t,a)=>t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a,i=(e,l,t)=>new Promise((a,r)=>{var o=e=>{try{i(t.next(e))}catch(l){r(l)}},s=e=>{try{i(t.throw(e))}catch(l){r(l)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,s);i((t=t.apply(e,l)).next())});import{d as n,D as m,x as u,a as d,S as p,o as c,e as j,f,h as v,p as x,z as b,I as y,u as h,G as _,H as g,y as w,aa as E,aX as V,l as O,m as P,aY as k,aQ as M,N as Y,aZ as A,aW as D}from"./index-Q3P-rwBo.js";import{E as N}from"./el-button-CEOXYcAP.js";import{a as T,E as U}from"./el-form-item-BUQepiSo.js";/* empty css                  *//* empty css                  *//* empty css                    */import{_ as I}from"./index.vue_vue_type_style_index_0_lang-B_oLGaIK.js";import{E as W}from"./el-row-DCMltfBO.js";/* empty css               */import{E as q,a as z}from"./el-option-pz7fCg4E.js";/* empty css                  *//* empty css                     *//* empty css                  */import{E as C}from"./el-col-BUW-HwBC.js";/* empty css                 */import{E as Q}from"./emojo-Ben6gd8J.js";import{P as S}from"./formEnum-BLgiZVxV.js";import{E as X}from"./index-CLGBRhnv.js";import{E as $}from"./index-CfHovYMh.js";import{E as H}from"./index-PuVtdB8r.js";import"./index-Bw2LRIqh.js";import"./index-CHpuP5IO.js";import"./use-form-common-props-CRk7VbzP.js";import"./castArray-CZnp3rbt.js";import"./index-DnxPVI-a.js";import"./baseClone-CfKSi0NA.js";import"./initCloneObject-DYoVbtXx.js";import"./index-BPdM6V2I.js";import"./index-DY7vEF7P.js";import"./aria-Dle50h-X.js";import"./index-DqvH5aSw.js";import"./index-BQ_Zlz14.js";import"./token-DWNpOE8r.js";import"./strings-DdTFLw4D.js";import"./event-BwRzfsZt.js";import"./scroll-Bn5eNAyQ.js";import"./debounce-CAXlUbCC.js";import"./toNumber-k875UdLj.js";import"./baseIteratee-5eh-Q3nf.js";import"./index-Bh-n1rFb.js";import"./vnode-DaF8TtDL.js";import"./index-D1PeE8mn.js";import"./index-CB2zej36.js";import"./cloneDeep-C17vYunK.js";import"./validator-Cb6Lwz_y.js";const R={class:"max-w-250 mx-auto my-5"},Z={class:"p-5 mt-5 art-card-xs"},B={class:"mt-2.5"},G={key:0,class:"flex-cc flex-col w-65 h-40 border border-dashed border-[#d9d9d9] rounded-md"},L=["src"],F={class:"flex justify-end"},J=n((K=((e,l)=>{for(var t in l||(l={}))r.call(l,t)&&s(e,t,l[t]);if(a)for(var t of a(l))o.call(l,t)&&s(e,t,l[t]);return e})({},{name:"ArticlePublish"}),l(K,t({__name:"index",setup(e){const l=m(),t=u(),{accessToken:a}=t,r={Authorization:a},o=d(S.Add),s=d(""),n=d(),J=d([]),K=d(""),ee=d(""),le=d(""),te=d(!0),ae=()=>i(null,null,function*(){try{const{data:e}=yield M.get("https://www.qiniu.lingchen.kim/blog_list.json");if(e.code===A.success){const{title:l,blog_class:t,html_content:a}=e.data;s.value=l,n.value=Number(t),K.value=a}}catch(e){Y.error("获取文章详情失败")}}),re=e=>D(e,"YYYY-MM-DD").value,oe=()=>s.value.trim()?n.value?K.value&&"<p><br></p>"!==K.value?!!le.value||(Y.error("请上传封面图片"),!1):(Y.error("请输入文章内容"),!1):(Y.error("请选择文章类型"),!1):(Y.error("请输入文章标题"),!1),se=e=>e.replace(/(\s*)<\/code>/g,"</code>"),ie=()=>{o.value===S.Edit?i(null,null,function*(){if(oe())try{se(K.value)}catch(e){Y.error("保存文章失败")}}):i(null,null,function*(){if(oe())try{se(K.value)}catch(e){Y.error("发布文章失败")}})},ne=e=>{le.value=e.data.url,Y.success(`图片上传成功 ${Q[200]}`)},me=()=>{Y.error(`图片上传失败 ${Q[500]}`)},ue=e=>{const l=e.type.startsWith("image/"),t=e.size/1024/1024<2;return l?!!t||(Y.error("图片大小不能超过 2MB"),!1):(Y.error("只能上传图片文件"),!1)},{scrollToTop:de}=p();return c(()=>{de(),i(null,null,function*(){try{const{data:e}=yield M.get("https://www.qiniu.lingchen.kim/classify.json");200===e.code&&(J.value=e.data)}catch(e){Y.error("获取文章分类失败")}}),(()=>{const{id:e}=l.query;o.value=e?S.Edit:S.Add,o.value===S.Edit?ae():ee.value=re(k().value)})()}),(e,l)=>{const t=X,a=C,i=z,m=q,u=W,d=I,p=E,c=$,k=T,M=H,Y=U,A=N;return f(),j("div",null,[v("div",null,[v("div",R,[x(u,{gutter:10},{default:b(()=>[x(a,{span:18},{default:b(()=>[x(t,{modelValue:h(s),"onUpdate:modelValue":l[0]||(l[0]=e=>y(s)?s.value=e:null),modelModifiers:{trim:!0},placeholder:"请输入文章标题（最多100个字符）",maxlength:"100"},null,8,["modelValue"])]),_:1}),x(a,{span:6},{default:b(()=>[x(m,{modelValue:h(n),"onUpdate:modelValue":l[1]||(l[1]=e=>y(n)?n.value=e:null),placeholder:"请选择文章类型",filterable:""},{default:b(()=>[(f(!0),j(_,null,g(h(J),e=>(f(),w(i,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),x(d,{class:"mt-2.5",modelValue:h(K),"onUpdate:modelValue":l[2]||(l[2]=e=>y(K)?K.value=e:null)},null,8,["modelValue"]),v("div",Z,[l[6]||(l[6]=v("h2",{class:"mb-5 text-xl font-medium"},"发布设置",-1)),x(Y,null,{default:b(()=>[x(k,{label:"封面"},{default:b(()=>[v("div",B,[x(c,{action:"undefined/api/common/upload",headers:r,"show-file-list":!1,"on-success":ne,"on-error":me,"before-upload":ue},{default:b(()=>[h(le)?(f(),j("img",{key:1,src:h(le),class:"block w-65 h-40 object-cover"},null,8,L)):(f(),j("div",G,[x(p,{class:"!text-xl !text-g-600"},{default:b(()=>[x(h(V))]),_:1}),l[4]||(l[4]=v("div",{class:"mt-2 text-sm text-g-600"},"点击上传封面",-1))]))]),_:1}),l[5]||(l[5]=v("div",{class:"mt-2 text-xs text-g-700"},"建议尺寸 16:9，jpg/png 格式",-1))])]),_:1}),x(k,{label:"可见"},{default:b(()=>[x(M,{modelValue:h(te),"onUpdate:modelValue":l[3]||(l[3]=e=>y(te)?te.value=e:null)},null,8,["modelValue"])]),_:1})]),_:1}),v("div",F,[x(A,{type:"primary",onClick:ie,class:"w-25"},{default:b(()=>[O(P(h(o)===h(S).Edit?"保存":"发布"),1)]),_:1})])])])])])}}}))));var K;export{J as default};
