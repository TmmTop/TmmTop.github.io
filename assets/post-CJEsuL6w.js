var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,a=(t,s,o)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o,i=(e,t,s)=>new Promise((o,r)=>{var n=e=>{try{i(s.next(e))}catch(t){r(t)}},a=e=>{try{i(s.throw(e))}catch(t){r(t)}},i=e=>e.done?o(e.value):Promise.resolve(e.value).then(n,a);i((s=s.apply(e,t)).next())});import{dS as d,dT as c}from"./index-80d0f50K.js";function l(e){return i(this,null,function*(){const{postName:i,postCode:l,status:p,pageNum:u=1,pageSize:m=10}=e||{};let y=d.from("sys_post").select("*",{count:"exact"}),f=(u-1)*m;i&&(y=y.ilike("post_name",`%${i}%`),f=0),l&&(y=y.ilike("post_code",`%${l}%`),f=0),void 0!==p&&(y=y.eq("status",1===p),f=0);const{data:_,error:g,count:q}=yield y.order("sort",{ascending:!0}).range(f,f+m-1);if(g&&c(g.code,"获取岗位列表失败"),_){return{list:_.map(e=>{return i=((e,t)=>{for(var s in t||(t={}))r.call(t,s)&&a(e,s,t[s]);if(o)for(var s of o(t))n.call(t,s)&&a(e,s,t[s]);return e})({},e),d={status:e.status?1:0},t(i,s(d));var i,d}),total:q||0,pageNum:u,pageSize:m}}return{list:[],total:0,pageNum:u,pageSize:m}})}function p(e){return i(this,null,function*(){const{postName:t,postCode:s,postSort:o,status:r,remark:n}=e,{data:a}=yield d.from("sys_post").select("id").eq("post_name",t).single();a&&c("0","岗位名称已存在");const{data:i}=yield d.from("sys_post").select("id").eq("post_code",s).single();i&&c("0","岗位编码已存在");const{data:l,error:p}=yield d.from("sys_post").insert({post_name:t,post_code:s,sort:o,status:r,remark:n}).select("id").single();return!p&&l||c(p.code,"创建岗位失败"),{message:"创建岗位成功"}})}function u(e,t){return i(this,null,function*(){e||c("0","岗位ID不能为空");const{postName:s,postCode:o,postSort:r,status:n,remark:a}=t,{data:i,error:l}=yield d.from("sys_post").select("id, post_name, post_code").eq("id",e).single();if(!l&&i||c(l.code,"岗位不存在"),s&&s!==(null==i?void 0:i.post_name)){const{data:t}=yield d.from("sys_post").select("id").eq("post_name",s).neq("id",e).single();t&&c("0","岗位名称已存在")}if(o&&o!==(null==i?void 0:i.post_code)){const{data:t}=yield d.from("sys_post").select("id").eq("post_code",o).neq("id",e).single();t&&c("0","岗位编码已存在")}const{error:p}=yield d.from("sys_post").update({post_name:s,post_code:o,sort:r,status:n,remark:a}).eq("id",e);return p&&c(p.code,"更新岗位失败"),{message:"更新岗位成功"}})}function m(e){return i(this,null,function*(){e||c("0","岗位ID不能为空");const{data:t,error:s}=yield d.from("sys_post").select("id").eq("id",e).single();!s&&t||c(s.code,"岗位不存在");const{data:o,error:r}=yield d.from("sys_user").select("id").eq("post_id",e);r&&c(r.code,"检查岗位用户失败"),o&&o.length>0&&c("0","该岗位下存在用户，无法删除");const{error:n}=yield d.from("sys_post").delete().eq("id",e);return n&&c(n.code,"删除岗位失败"),{message:"删除岗位成功"}})}export{p as c,m as d,l as g,u};
