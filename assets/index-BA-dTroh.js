var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(t,o,r)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[o]=r,n=(e,t,o)=>new Promise((r,i)=>{var a=e=>{try{n(o.next(e))}catch(t){i(t)}},s=e=>{try{n(o.throw(e))}catch(t){i(t)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,s);n((o=o.apply(e,t)).next())});import{d as p,v as l,a as m,F as d,e as u,f as c,p as j,z as f,u as h,I as g,J as v,k as y,y as b,l as x,m as _,n as w,N as O,a8 as S}from"./index-Q3P-rwBo.js";import{E as C}from"./el-card-DLHCeoYL.js";import{_ as T}from"./index-CRqOUFcL.js";import{_ as P}from"./index-CvW_mWnQ.js";import{E as k}from"./el-space-CvQOeTo3.js";import{E as $}from"./el-button-CEOXYcAP.js";import{u as E}from"./useTable-Dfk4pq9G.js";import{d as D,a as z}from"./dept-P1pZEdqx.js";import{_ as I}from"./dept-dialog.vue_vue_type_script_setup_true_lang-BfZFAze_.js";import{_ as F}from"./index.vue_vue_type_script_setup_true_lang-DyJxhaMK.js";/* empty css                *//* empty css                *//* empty css              */import{u as N}from"./useAuth-BpHyao-4.js";import{E as A}from"./index-CCQtYmAP.js";import{E as M}from"./index-BQ_Zlz14.js";import{E as B}from"./index-BPdM6V2I.js";import"./el-pagination-DQ3AHnM4.js";import"./el-option-pz7fCg4E.js";import"./index-DqvH5aSw.js";import"./index-DnxPVI-a.js";import"./token-DWNpOE8r.js";import"./strings-DdTFLw4D.js";import"./castArray-CZnp3rbt.js";import"./index-CHpuP5IO.js";import"./index-Bw2LRIqh.js";import"./use-form-common-props-CRk7VbzP.js";import"./index-CLGBRhnv.js";import"./event-BwRzfsZt.js";import"./index-D1PeE8mn.js";import"./aria-Dle50h-X.js";import"./scroll-Bn5eNAyQ.js";import"./debounce-CAXlUbCC.js";import"./toNumber-k875UdLj.js";import"./baseIteratee-5eh-Q3nf.js";import"./index-Bh-n1rFb.js";import"./vnode-DaF8TtDL.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 */import"./el-table-column-C6atLf5U.js";import"./initCloneObject-DYoVbtXx.js";import"./isArrayLikeObject-BaR2EV2x.js";import"./raf-Cj-WcgTR.js";import"./index-elQxurtn.js";/* empty css                    *//* empty css                   */import"./el-empty-DpszSlQy.js";import"./formEnum-BLgiZVxV.js";import"./plugin-vue_export-helper-BCo6x5W8.js";import"./el-popover-B7NtVZA-.js";import"./el-dropdown-item-Cz20UzFR.js";import"./refs-Cw5r5QN8.js";import"./index-DY7vEF7P.js";/* empty css                        */import"./index.vue_vue_type_script_setup_true_lang-Cy6sF_S5.js";import"./vue-draggable-plus-3lGWS1j6.js";import"./useTableColumns-4JhvAf6e.js";import"./el-dialog-DSZOKVfF.js";import"./index-NgMJylyR.js";import"./el-overlay-BNvnZVrW.js";import"./index-C9GIbpAR.js";import"./el-form-item-BUQepiSo.js";import"./baseClone-CfKSi0NA.js";/* empty css                        */import"./el-row-DCMltfBO.js";import"./el-col-BUW-HwBC.js";/* empty css                *//* empty css                *//* empty css                       */import"./index-DYv8S7Ln.js";import"./index-D1q65U0P.js";import"./index-fNUsGspI.js";import"./index-Cr-VvCPY.js";import"./index-CJ3GxM9Y.js";import"./validator-Cb6Lwz_y.js";const H={class:"dept-page art-full-height"},R=p((U=((e,t)=>{for(var o in t||(t={}))i.call(t,o)&&s(e,o,t[o]);if(r)for(var o of r(t))a.call(t,o)&&s(e,o,t[o]);return e})({},{name:"Dept"}),t(U,o({__name:"index",setup(e){const{t:t}=l(),{hasAuth:o}=N(),r=m("add"),i=m(!1),a=m({}),s=m([]);m({page:1,pageSize:10,deptName:void 0,status:void 0});const p={0:{type:"info",text:"禁用"},1:{type:"success",text:"启用"}},{columns:R,columnChecks:U,data:J,loading:L,handleSizeChange:W,handleCurrentChange:q,refreshData:K}=E({core:{apiFn:z,apiParams:{},columnsFactory:()=>[{type:"selection"},{type:"index",width:60,label:"序号"},{prop:"dept_name",label:"部门名称",minWidth:200,showOverflowTooltip:!0},{prop:"dept_code",label:"部门编码",width:120,showOverflowTooltip:!0},{prop:"leader",label:"负责人",width:120,showOverflowTooltip:!0},{prop:"phone",label:"联系电话",width:150,showOverflowTooltip:!0},{prop:"email",label:"邮箱",width:150,showOverflowTooltip:!0},{prop:"status",label:"状态",width:80,formatter:e=>{const t=(o=e.status,p[o]||{type:"info",text:"未知"});var o;return S(M,{type:t.type},()=>t.text)}},{prop:"sort",label:"排序",width:80},{prop:"create_time",label:"创建时间",width:180,sortable:!0,showOverflowTooltip:!0,formatter:e=>(e=>{if(!e)return"-";const t=new Date(e);return isNaN(t.getTime())?"-":`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`})(e.create_time)},{prop:"operation",label:"操作",width:180,fixed:"right",formatter:e=>S("div",[S(B,{content:t("menus.system.edit"),placement:"top"},()=>S(F,{type:"edit",onClick:()=>Y("edit",e),style:o("dept:update")?"":"display: none"})),S(B,{content:t("menus.system.delete"),placement:"top"},()=>S(F,{type:"delete",onClick:()=>G(e),style:o("dept:delete")?"":"display: none"}))])}]}}),Y=(e,t)=>{r.value=e,a.value="add"===e&&t?{parentId:t.id}:t||{},w(()=>{i.value=!0})},Z=()=>{if(0===s.value.length)return void O.warning("请选择要删除的部门");const e=s.value.map(e=>e.dept_name).join("、");A.confirm(`确定要删除选中的 ${s.value.length} 个部门吗？\n${e}`,"批量删除部门",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>n(null,null,function*(){try{const e=s.value.map(e=>e.id);let t=0;for(const o of e)(yield D(o.toString()))&&t++;t>0&&(O.success("批量删除成功"),s.value=[],K())}catch(e){O.error("批量删除失败")}})).catch(()=>{})},G=e=>{A.confirm(`确定要删除部门"${e.dept_name}"吗？`,"删除部门",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>n(null,null,function*(){try{(yield D(e.id.toString()))&&(O.success("删除成功"),K())}catch(t){O.error("删除失败")}})).catch(()=>{})},Q=()=>n(null,null,function*(){try{i.value=!1,a.value={},K()}catch(e){}}),V=e=>{s.value=e};return(e,t)=>{const n=$,p=k,l=P,m=T,w=C,O=d("ripple");return c(),u("div",H,[j(w,{class:"art-table-card",shadow:"never"},{default:f(()=>[j(l,{columns:h(U),"onUpdate:columns":t[1]||(t[1]=e=>g(U)?U.value=e:null),loading:h(L),onRefresh:h(K),"search-auth":"dept:query","refresh-auth":"dept:query"},{left:f(()=>[j(p,{wrap:""},{default:f(()=>[h(o)("dept:add")?v((c(),b(n,{key:0,onClick:t[0]||(t[0]=e=>Y("add"))},{default:f(()=>[...t[3]||(t[3]=[x("新增部门",-1)])]),_:1})),[[O]]):y("",!0),h(o)("dept:batchDelete")?v((c(),b(n,{key:1,onClick:Z,disabled:0===h(s).length,type:"danger"},{default:f(()=>[x(" 批量删除("+_(h(s).length)+") ",1)]),_:1},8,["disabled"])),[[O]]):y("",!0)]),_:1})]),_:1},8,["columns","loading","onRefresh"]),j(m,{loading:h(L),data:h(J),columns:h(R),"row-key":"id","default-expand-all":"",onSelectionChange:V,"onPagination:sizeChange":h(W),"onPagination:currentChange":h(q)},null,8,["loading","data","columns","onPagination:sizeChange","onPagination:currentChange"]),j(I,{visible:h(i),"onUpdate:visible":t[2]||(t[2]=e=>g(i)?i.value=e:null),type:h(r),"dept-data":h(a),onSubmit:Q},null,8,["visible","type","dept-data"])]),_:1})])}}}))));var U;export{R as default};
