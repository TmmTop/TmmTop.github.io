const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-tq4TX8ps.js","assets/index-1eFqJOOG.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,r,o)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,n=(e,t,r)=>new Promise((o,i)=>{var s=e=>{try{n(r.next(e))}catch(t){i(t)}},l=e=>{try{n(r.throw(e))}catch(t){i(t)}},n=e=>e.done?o(e.value):Promise.resolve(e.value).then(s,l);n((r=r.apply(e,t)).next())});import{d as a,a as p,o as m,dU as u,N as d,c,dV as j,aq as f,dW as y,dX as h,aF as v,aN as b,as as _,F as x,e as g,f as w,p as k,z as O,I as T,u as C,J as E,k as W,y as I,l as P,m as R,dY as S,aB as D,a8 as A}from"./index-tq4TX8ps.js";import{E as B}from"./el-card-1TQtZHl7.js";import{_ as F}from"./index-D7po0RYc.js";import{_ as L}from"./index-CJmSPapq.js";import{E as M}from"./el-button-DyAC8C5p.js";import{_ as N}from"./index.vue_vue_type_script_setup_true_lang-AGHcUgcb.js";import{u as U}from"./useTableColumns-4pdzumz-.js";import{_ as V}from"./menu-dialog.vue_vue_type_script_setup_true_lang-D35QUHsP.js";/* empty css                *//* empty css                *//* empty css              */import{_ as q}from"./index.vue_vue_type_script_setup_true_lang-OUKHz1NZ.js";import{u as z}from"./useAuth-DYABuLzu.js";import{E as H}from"./index-Cpz5_xtZ.js";import{E as J}from"./index-BXZ9ghwX.js";import"./el-pagination-Iu5NmV1u.js";import"./el-option-DXreI6jV.js";import"./index-Ci_xIpBh.js";import"./index-WcMWsiUt.js";import"./index-DlJfAqfE.js";import"./aria-Dle50h-X.js";import"./index-DlvAES6j.js";import"./use-form-common-props-C1bnLtuv.js";import"./index-CANQjRc0.js";import"./token-DWNpOE8r.js";import"./strings-DOQVhMSl.js";import"./castArray-CHqCdZGF.js";import"./index-DK0M4ZfF.js";import"./index-DiYLWqjA.js";import"./event-BwRzfsZt.js";import"./index-CZ4uNybv.js";import"./scroll-CqDkJM1i.js";import"./debounce-638yRgBG.js";import"./toNumber-BfVc6Erv.js";import"./_baseIteratee-BuWUDJq-.js";import"./index-xLBHopRw.js";import"./vnode-C19zY2fz.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 */import"./el-table-column-BdqWJFUj.js";import"./_initCloneObject-SAMSSefA.js";import"./isArrayLikeObject-37-MgwE7.js";import"./raf-B9nJDbop.js";import"./index-CxO9A_c5.js";/* empty css                    *//* empty css                   */import"./el-empty-Bfaz4LgP.js";import"./formEnum-BLgiZVxV.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-popover-VYFidXkA.js";import"./el-dropdown-item-C5MgInp0.js";import"./refs-Cw5r5QN8.js";/* empty css                        */import"./vue-draggable-plus-Dh_etvWk.js";import"./el-dialog-BuI0cT_W.js";import"./index-ChLCAD_I.js";import"./el-overlay-eO4DGCYD.js";import"./index-DB3QIKIw.js";import"./index.vue_vue_type_script_setup_true_lang-7F_641Ai.js";import"./el-form-item-DcUonGVO.js";import"./_baseClone-Cjzv5Fw5.js";import"./el-row-B5j5eqHP.js";import"./el-col-BO93OLd3.js";import"./el-radio-DLchf3N0.js";import"./tree-select-Bvj0mN0n.js";import"./cloneDeep-67QEKC_q.js";import"./index-Ccr30ub6.js";import"./index-CCK94ktD.js";import"./clamp-8JRzLQ7F.js";import"./index-gtba-Hok.js";import"./index-DdKsqEII.js";import"./index-T9D55G5l.js";import"./index-DL46FidT.js";import"./index-CK6JhDoQ.js";import"./validator--HL6f0Bm.js";const K={class:"menu-page art-full-height"},X=a(($=((e,t)=>{for(var r in t||(t={}))i.call(t,r)&&l(e,r,t[r]);if(o)for(var r of o(t))s.call(t,r)&&l(e,r,t[r]);return e})({},{name:"Menus"}),t($,r({__name:"index",setup(e){const{hasAuth:t}=z(),r=p(!1),o=p(),i=p([]),s=p(!1),l=p(null),a=p(!1);m(()=>{X()});const X=()=>n(null,null,function*(){r.value=!0;try{const e={},t=yield u(e);t&&(Q.value=t,yield se())}catch(e){d.error("获取菜单失败")}finally{r.value=!1}}),$=e=>0===e.type?"info":1===e.type?"success":2===e.type?"primary":e.link&&e.isIframe?"warning":e.link?"danger":"info",Y=e=>0===e.type?"目录":1===e.type?"菜单":2===e.type?"按钮":e.link&&e.isIframe?"内嵌":e.link?"外链":"未知",{columnChecks:Z,columns:G}=U(()=>[{type:"selection",width:55},{prop:"title",label:"菜单名称",minWidth:120,showOverflowTooltip:!0,formatter:e=>D(e.title||e.title||"")},{prop:"name",label:"菜单标识",minWidth:120,showOverflowTooltip:!0,formatter:e=>e.name||e.name||""},{prop:"perms",label:"权限标识",minWidth:120,showOverflowTooltip:!0,formatter:e=>e.perms||e.perms||""},{prop:"path",label:"路由地址",minWidth:150,showOverflowTooltip:!0,formatter:e=>e.link||e.path||""},{prop:"component",label:"组件路径",minWidth:150,showOverflowTooltip:!0,formatter:e=>e.component||"-"},{prop:"icon",label:"图标",width:100,showOverflowTooltip:!0,formatter:e=>A(q,{icon:e.icon||"-"},()=>Y(e))},{prop:"type",label:"菜单类型",width:100,formatter:e=>A(J,{type:$(e)},()=>Y(e))},{prop:"sort",label:"排序",width:80,formatter:e=>e.sort||0},{prop:"status",label:"状态",width:80,formatter:e=>{const t=1===e.status?{type:"success",text:"启用"}:{type:"info",text:"禁用"};return A(J,{type:t.type},()=>t.text)}},{prop:"operation",label:"操作",width:150,fixed:"right",formatter:e=>A("div",[A(N,{type:"edit",onClick:()=>oe(e),style:t("menu:update")?"":"display: none"}),A(N,{type:"delete",onClick:()=>le(e),style:t("menu:delete")?"":"display: none"})])}]),Q=p([]),ee=()=>{X()},te=c(()=>Q.value),re=e=>{l.value=null,a.value=!1,s.value=!0},oe=e=>{l.value=e,a.value=!0,s.value=!0},ie=e=>n(null,null,function*(){try{s.value=!1,X()}catch(e){}}),se=()=>n(null,null,function*(){try{j(f);const e=y();if(!e)return;const t=new h,r=yield t.getMenuList();e.reregister(r);const o=v();o.setMenuList(r),o.addRemoveRouteFns(e.getRemoveRouteFns()),b.getInstance().save();const{useWorktabStore:i}=yield _(()=>n(null,null,function*(){const{useWorktabStore:e}=yield import("./index-tq4TX8ps.js").then(e=>e.ei);return{useWorktabStore:e}}),__vite__mapDeps([0,1]));i().validateWorktabs(f)}catch(e){d.error("刷新菜单失败")}}),le=e=>n(null,null,function*(){try{yield H.confirm("确定要删除该菜单吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(yield S(e.id))&&(d.success("删除成功"),yield X(),yield se())}catch(t){"cancel"!==t&&d.error("删除失败")}}),ne=e=>{const t=ae(e);i.value=t},ae=e=>{const t=new Set;return e.filter(e=>{const r=e.id;return!t.has(r)&&(t.add(r),!0)})},pe=e=>{const t=[e.id.toString()];return e.children&&e.children.length>0&&e.children.forEach(e=>{t.push(...pe(e))}),t},me=()=>n(null,null,function*(){if(0!==i.value.length)try{yield H.confirm(`确定要删除选中的 ${i.value.length} 个菜单吗？删除后无法恢复，包括所有子菜单和关联的角色数据`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=[];i.value.forEach(t=>{e.push(...pe(t))});let t=0;for(const r of e)(yield S(r.toString()))&&t++;t>0&&(d.success(`成功删除 ${t} 个菜单`),i.value=[],yield X(),yield se())}catch(e){"cancel"!==e&&d.error("删除失败")}else d.warning("请选择要删除的菜单")});return(e,n)=>{const p=M,m=L,u=F,d=B,c=x("ripple");return w(),g("div",K,[k(d,{class:"art-table-card",shadow:"never"},{default:O(()=>[k(m,{showZebra:!1,loading:C(r),columns:C(Z),"onUpdate:columns":n[0]||(n[0]=e=>T(Z)?Z.value=e:null),onRefresh:ee,"search-auth":"menu:query","refresh-auth":"menu:query"},{left:O(()=>[C(t)("menu:add")?E((w(),I(p,{key:0,onClick:re},{default:O(()=>[...n[2]||(n[2]=[P(" 添加菜单 ",-1)])]),_:1})),[[c]]):W("",!0),C(t)("menu:batchDelete")?E((w(),I(p,{key:1,disabled:0===C(i).length,type:"danger",onClick:me},{default:O(()=>[P(" 批量删除 ("+R(C(i).length)+") ",1)]),_:1},8,["disabled"])),[[c]]):W("",!0)]),_:1},8,["loading","columns"]),k(u,{ref_key:"tableRef",ref:o,rowKey:"id",loading:C(r),columns:C(G),data:C(te),stripe:!1,"tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":!0,onSelectionChange:ne},null,8,["loading","columns","data"]),k(V,{visible:C(s),"onUpdate:visible":n[1]||(n[1]=e=>T(s)?s.value=e:null),editData:C(l),lockType:C(a),onSubmit:ie},null,8,["visible","editData","lockType"])]),_:1})])}}}))));var $;export{X as default};
