var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,n=(e,t)=>{for(var r in t||(t={}))o.call(t,r)&&i(e,r,t[r]);if(a)for(var r of a(t))s.call(t,r)&&i(e,r,t[r]);return e},p=(e,a)=>t(e,r(a)),l=(e,t,r)=>new Promise((a,o)=>{var s=e=>{try{n(r.next(e))}catch(t){o(t)}},i=e=>{try{n(r.throw(e))}catch(t){o(t)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(s,i);n((r=r.apply(e,t)).next())});import{d as m,v as u,a as d,c,F as j,e as v,f as g,p as f,u as h,I as y,z as x,J as _,k as b,y as w,l as S,m as O,n as C,N as P,a8 as T}from"./index-tq4TX8ps.js";import{E as k}from"./el-card-1TQtZHl7.js";import{_ as z}from"./index-D7po0RYc.js";import{_ as E}from"./index-CJmSPapq.js";import{E as $}from"./el-space-DCpBHUry.js";import{E as D}from"./el-button-DyAC8C5p.js";import{_ as A}from"./index.vue_vue_type_script_setup_true_lang-AGHcUgcb.js";import{A as I}from"./formData-CAGfC0QB.js";import{u as F}from"./useTable-BCdofZYT.js";import{_ as R,b as U,g as V,d as B}from"./user-dialog.vue_vue_type_script_setup_true_lang-D_vwoXOZ.js";import{_ as M}from"./user-search.vue_vue_type_script_setup_true_lang-DtWsCrWA.js";/* empty css                *//* empty css                *//* empty css              */import{u as N}from"./useAuth-DYABuLzu.js";import{E as q}from"./index-Cpz5_xtZ.js";import{E as H}from"./index-BXvaDdvM.js";import{E as J}from"./index-BXZ9ghwX.js";import{E as L}from"./index-Ci_xIpBh.js";import"./el-pagination-Iu5NmV1u.js";import"./el-option-DXreI6jV.js";import"./index-CANQjRc0.js";import"./index-WcMWsiUt.js";import"./token-DWNpOE8r.js";import"./strings-DOQVhMSl.js";import"./castArray-CHqCdZGF.js";import"./index-DlvAES6j.js";import"./index-DK0M4ZfF.js";import"./use-form-common-props-C1bnLtuv.js";import"./index-DiYLWqjA.js";import"./event-BwRzfsZt.js";import"./index-CZ4uNybv.js";import"./aria-Dle50h-X.js";import"./scroll-CqDkJM1i.js";import"./debounce-638yRgBG.js";import"./toNumber-BfVc6Erv.js";import"./_baseIteratee-BuWUDJq-.js";import"./index-xLBHopRw.js";import"./vnode-C19zY2fz.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 */import"./el-table-column-BdqWJFUj.js";import"./_initCloneObject-SAMSSefA.js";import"./isArrayLikeObject-37-MgwE7.js";import"./raf-B9nJDbop.js";import"./index-CxO9A_c5.js";/* empty css                    *//* empty css                   */import"./el-empty-Bfaz4LgP.js";import"./formEnum-BLgiZVxV.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-popover-VYFidXkA.js";import"./el-dropdown-item-C5MgInp0.js";import"./refs-Cw5r5QN8.js";import"./index-DlJfAqfE.js";/* empty css                        */import"./index.vue_vue_type_script_setup_true_lang-OUKHz1NZ.js";import"./vue-draggable-plus-Dh_etvWk.js";import"./avatar1-CutlWZf5.js";import"./avatar6-VNTlcTK9.js";import"./avatar9-oKrDyQhv.js";import"./avatar10-Dom60BwY.js";import"./useTableColumns-4pdzumz-.js";import"./el-dialog-BuI0cT_W.js";import"./index-ChLCAD_I.js";import"./el-overlay-eO4DGCYD.js";import"./index-DB3QIKIw.js";import"./el-form-item-DcUonGVO.js";import"./_baseClone-Cjzv5Fw5.js";/* empty css                *//* empty css                *//* empty css                       */import"./el-row-B5j5eqHP.js";import"./el-col-BO93OLd3.js";import"./role-CTBCBT8L.js";import"./dept-CnZj34Rz.js";import"./post-BKd4v_6B.js";import"./index-DdKsqEII.js";import"./index-T9D55G5l.js";import"./index-DL46FidT.js";import"./index-BQes9nue.js";import"./el-radio-DLchf3N0.js";import"./tree-select-Bvj0mN0n.js";import"./cloneDeep-67QEKC_q.js";import"./index-Ccr30ub6.js";import"./index-CCK94ktD.js";import"./clamp-8JRzLQ7F.js";import"./index-gtba-Hok.js";import"./index-CK6JhDoQ.js";import"./validator--HL6f0Bm.js";const K={class:"user-page art-full-height"},W=m(p(n({},{name:"User"}),{__name:"index",setup(e){const{t:t}=u(),{hasAuth:r}=N(),a=d("add"),o=d(!1),s=d({}),i=d([]),m=d({page:1,pageSize:10,username:void 0,status:void 0,deptId:void 0}),W={0:{type:"info",text:"禁用"},1:{type:"success",text:"启用"}},X={0:{text:"未知"},1:{text:"男"},2:{text:"女"}},Y=c(()=>i.value.some(e=>"admin"===e.username)),{columns:Z,columnChecks:G,data:Q,loading:ee,pagination:te,fetchData:re,searchParams:ae,resetSearchParams:oe,handleSizeChange:se,handleCurrentChange:ie,refreshData:ne}=F({core:{apiFn:V,apiParams:n({page:1,pageSize:10},m.value),paginationKey:{current:"page",size:"pageSize"},columnsFactory:()=>[{type:"selection"},{type:"index",width:60,label:"序号"},{prop:"userInfo",label:"用户信息",width:150,formatter:e=>T("div",{class:"user flex-c"},[T(H,{class:"size-9.5 rounded-md",src:e.avatar||I[0].avatar,previewSrcList:[e.avatar||I[0].avatar],previewTeleported:!0}),T("div",{class:"ml-2"},[T("p",{class:"user-name"},e.username),T("p",{class:"email"},e.nickname||"-")])])},{prop:"email",label:"邮箱",width:180,showOverflowTooltip:!0},{prop:"dept_name",label:"部门",width:120,showOverflowTooltip:!0,formatter:e=>{var t;return(null==(t=e.sys_dept)?void 0:t.dept_name)||"-"}},{prop:"post_name",label:"岗位",width:120,showOverflowTooltip:!0,formatter:e=>{var t;return(null==(t=e.sys_post)?void 0:t.post_name)||"-"}},{prop:"role_names",label:"角色",minWidth:120,width:"auto",showOverflowTooltip:!0,formatter:e=>e.role_names||"-"},{prop:"gender",label:"性别",width:80,formatter:e=>{return(t=e.gender,X[t]||{text:"未知"}).text;var t}},{prop:"status",label:"状态",width:80,formatter:e=>{const t=(r=e.status,W[r]||{type:"info",text:"未知"});var r;return T(J,{type:t.type},()=>t.text)}},{prop:"create_time",label:"创建时间",width:180,sortable:!0,showOverflowTooltip:!0,formatter:e=>(e=>{if(!e)return"-";const t=new Date(e);return isNaN(t.getTime())?"-":`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`})(e.create_time)},{prop:"operation",label:"操作",width:150,fixed:"right",formatter:e=>T("div",[T(L,{content:t("menus.system.edit"),placement:"top"},()=>T(A,{type:"edit",onClick:()=>le("edit",e),style:r("user:update")?"":"display: none"})),T(L,{content:t("menus.system.delete"),placement:"top"},()=>T(A,{type:"delete",disabled:"admin"===e.username,onClick:()=>me(e),style:r("user:delete")?"":"display: none"}))])}]},transform:{dataTransformer:e=>Array.isArray(e)?e.map(e=>p(n({},e),{avatar:e.avatar||I[0].avatar})):[]}}),pe=e=>{Object.assign(ae,e),re()},le=(e,t)=>{a.value=e,s.value=t||{},C(()=>{o.value=!0})},me=e=>{"admin"!==e.username?q.confirm(`确定要删除用户"${e.username}"吗？`,"删除用户",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>l(null,null,function*(){try{yield B(e.id),P.success("删除成功"),ne()}catch(t){P.error(t.message||"删除失败")}})).catch(()=>{}):P.warning("不能删除admin用户")},ue=()=>{if(0===i.value.length)return void P.warning("请选择要删除的用户");if(i.value.some(e=>"admin"===e.username))return void P.warning("不能删除admin用户");const e=i.value.map(e=>e.username).join("、");q.confirm(`确定要删除选中的 ${i.value.length} 个用户吗？\n${e}`,"批量删除用户",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>l(null,null,function*(){try{const e=i.value.map(e=>e.id);yield U(e),P.success("批量删除成功"),i.value=[],ne()}catch(e){P.error(e.message||"批量删除失败")}})).catch(()=>{})},de=()=>l(null,null,function*(){try{o.value=!1,s.value={},ne()}catch(e){}}),ce=e=>{i.value=e};return(e,t)=>{const n=D,p=$,l=E,u=z,d=k,c=j("ripple");return g(),v("div",K,[f(M,{modelValue:h(m),"onUpdate:modelValue":t[0]||(t[0]=e=>y(m)?m.value=e:null),onSearch:pe,onReset:h(oe),"search-auth":"user:query","reset-auth":"user:query"},null,8,["modelValue","onReset"]),f(d,{class:"art-table-card",shadow:"never"},{default:x(()=>[f(l,{columns:h(G),"onUpdate:columns":t[2]||(t[2]=e=>y(G)?G.value=e:null),loading:h(ee),onRefresh:h(ne),"search-auth":"user:query","refresh-auth":"user:query"},{left:x(()=>[f(p,{wrap:""},{default:x(()=>[h(r)("user:add")?_((g(),w(n,{key:0,onClick:t[1]||(t[1]=e=>le("add"))},{default:x(()=>[...t[4]||(t[4]=[S("新增用户",-1)])]),_:1})),[[c]]):b("",!0),h(r)("user:batchDelete")?_((g(),w(n,{key:1,onClick:ue,disabled:0===h(i).length||h(Y),type:"danger"},{default:x(()=>[S(" 批量删除("+O(h(i).length)+") ",1)]),_:1},8,["disabled"])),[[c]]):b("",!0)]),_:1})]),_:1},8,["columns","loading","onRefresh"]),f(u,{loading:h(ee),data:h(Q),columns:h(Z),pagination:h(te),onSelectionChange:ce,"onPagination:sizeChange":h(se),"onPagination:currentChange":h(ie)},null,8,["loading","data","columns","pagination","onPagination:sizeChange","onPagination:currentChange"]),f(R,{visible:h(o),"onUpdate:visible":t[3]||(t[3]=e=>y(o)?o.value=e:null),type:h(a),"user-data":h(s),onSubmit:de},null,8,["visible","type","user-data"])]),_:1})])}}}));export{W as default};
