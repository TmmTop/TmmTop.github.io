var e=(e,l,a)=>new Promise((t,d)=>{var o=e=>{try{s(a.next(e))}catch(l){d(l)}},r=e=>{try{s(a.throw(e))}catch(l){d(l)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,r);s((a=a.apply(e,l)).next())});import{d as l,c as a,a as t,r as d,w as o,y as r,f as s,z as p,p as u,u as i,h as n,l as m,I as c,N as f,n as h}from"./index-80d0f50K.js";import{E as _}from"./el-dialog-1gzNkj9H.js";import"./el-overlay-GydQvYeA.js";import{E as g}from"./el-button-fxR6_Zjf.js";import{E as b,a as v}from"./el-form-item-fw-CxUqd.js";/* empty css               */import{E as y,a as V}from"./el-option-1zm3uFw0.js";/* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                        */import{E as j}from"./el-row-CWq4c_Ai.js";import{E as x}from"./el-col-DtVXklDZ.js";/* empty css                *//* empty css                    *//* empty css                *//* empty css                       */import{c as E,u as U,g as k,b as w}from"./dept-KG10lbx8.js";import{E as C}from"./index-Bw7fD_Sj.js";import{E as N}from"./index-HP-ZmGVO.js";import{E as I}from"./index-BJAVXn5l.js";const D={class:"dialog-footer"},H=l({__name:"dept-dialog",props:{visible:{type:Boolean},type:{},deptData:{}},emits:["update:visible","submit"],setup(l,{emit:H}){const P=l,q=H,M=a({get:()=>P.visible,set:e=>q("update:visible",e)}),O=a(()=>P.type),R=t(),$=t(!1),z=t([]),B={value:"id",label:"dept_name",children:"children"},F=d({parentId:0,deptCode:"",deptName:"",leader:"",phone:"",email:"",sort:0,status:1}),J={deptCode:[{required:!0,message:"请输入部门编码",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],deptName:[{required:!0,message:"请输入部门名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]};function L(){const e=[],l=a=>{a.forEach(a=>{e.push(a.id),a.children&&a.children.length>0&&l(a.children)})};return l(z.value),e}o(()=>[P.visible,P.type,P.deptData],([l])=>{l&&(e(null,null,function*(){try{const e=yield k(),l=yield w(e);z.value=[{id:0,dept_code:"",dept_name:"顶级部门",parent_id:0,children:l}]}catch(e){}}),e(null,null,function*(){const e="edit"===O.value&&P.deptData,l=P.deptData;Object.assign(F,{parentId:e&&l&&l.parent_id||0,deptCode:e&&l&&l.dept_code||"",deptName:e&&l&&l.dept_name||"",leader:e&&l&&l.leader||"",phone:e&&l&&l.phone||"",email:e&&l&&l.email||"",sort:e&&l?l.sort:0,status:e&&l?l.status:1})}),h(()=>{var e;null==(e=R.value)||e.clearValidate()}))},{immediate:!0});const Q=()=>e(null,null,function*(){R.value&&(yield R.value.validate(l=>e(null,null,function*(){var e;if(l){$.value=!0;try{"add"===O.value?(yield E(F),f.success("添加成功")):(yield U(null==(e=P.deptData)?void 0:e.id,F),f.success("更新成功")),M.value=!1,q("submit")}catch(a){f.error(a.message||"操作失败")}finally{$.value=!1}}})))});return(e,l)=>{const a=C,t=v,d=x,o=N,f=j,h=I,E=V,U=y,k=b,w=g,H=_;return s(),r(H,{modelValue:i(M),"onUpdate:modelValue":l[9]||(l[9]=e=>c(M)?M.value=e:null),title:"add"===i(O)?"添加部门":"编辑部门",width:"600px","align-center":"","close-on-click-modal":!1},{footer:p(()=>[n("div",D,[u(w,{onClick:l[8]||(l[8]=e=>M.value=!1)},{default:p(()=>[...l[10]||(l[10]=[m("取消",-1)])]),_:1}),u(w,{type:"primary",onClick:Q,loading:i($)},{default:p(()=>[...l[11]||(l[11]=[m("提交",-1)])]),_:1},8,["loading"])])]),default:p(()=>[u(k,{ref_key:"formRef",ref:R,model:i(F),rules:J,"label-width":"100px"},{default:p(()=>[u(f,{gutter:20},{default:p(()=>[u(d,{span:12},{default:p(()=>[u(t,{label:"上级部门",prop:"parentId"},{default:p(()=>[u(a,{modelValue:i(F).parentId,"onUpdate:modelValue":l[0]||(l[0]=e=>i(F).parentId=e),data:i(z),props:B,"default-expanded-keys":L(),"node-key":"id","render-after-expand":!1,"check-strictly":"",placeholder:"请选择上级部门",style:{width:"100%"}},null,8,["modelValue","data","default-expanded-keys"])]),_:1})]),_:1}),u(d,{span:12},{default:p(()=>[u(t,{label:"部门编码",prop:"deptCode"},{default:p(()=>[u(o,{modelValue:i(F).deptCode,"onUpdate:modelValue":l[1]||(l[1]=e=>i(F).deptCode=e),placeholder:"请输入部门编码",disabled:"edit"===i(O)},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),u(f,{gutter:20},{default:p(()=>[u(d,{span:12},{default:p(()=>[u(t,{label:"部门名称",prop:"deptName"},{default:p(()=>[u(o,{modelValue:i(F).deptName,"onUpdate:modelValue":l[2]||(l[2]=e=>i(F).deptName=e),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1})]),_:1}),u(d,{span:12},{default:p(()=>[u(t,{label:"负责人",prop:"leader"},{default:p(()=>[u(o,{modelValue:i(F).leader,"onUpdate:modelValue":l[3]||(l[3]=e=>i(F).leader=e),placeholder:"请输入负责人"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(f,{gutter:20},{default:p(()=>[u(d,{span:12},{default:p(()=>[u(t,{label:"联系电话",prop:"phone"},{default:p(()=>[u(o,{modelValue:i(F).phone,"onUpdate:modelValue":l[4]||(l[4]=e=>i(F).phone=e),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1})]),_:1}),u(d,{span:12},{default:p(()=>[u(t,{label:"邮箱",prop:"email"},{default:p(()=>[u(o,{modelValue:i(F).email,"onUpdate:modelValue":l[5]||(l[5]=e=>i(F).email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(f,{gutter:20},{default:p(()=>[u(d,{span:12},{default:p(()=>[u(t,{label:"排序",prop:"sort"},{default:p(()=>[u(h,{modelValue:i(F).sort,"onUpdate:modelValue":l[6]||(l[6]=e=>i(F).sort=e),min:0,max:999,placeholder:"请输入排序",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),u(d,{span:12},{default:p(()=>[u(t,{label:"状态",prop:"status"},{default:p(()=>[u(U,{modelValue:i(F).status,"onUpdate:modelValue":l[7]||(l[7]=e=>i(F).status=e),placeholder:"请选择状态",style:{width:"100%"}},{default:p(()=>[u(E,{label:"启用",value:1}),u(E,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}});export{H as _};
