var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,n=(e,t)=>{for(var l in t||(t={}))s.call(t,l)&&r(e,l,t[l]);if(a)for(var l of a(t))o.call(t,l)&&r(e,l,t[l]);return e},c=(e,a)=>t(e,l(a));import{E as d,a as i}from"./el-option-DXreI6jV.js";import{E as u}from"./index-T9D55G5l.js";import{W as p,w as f,c as h,t as v,n as y,d as k,a7 as m,ae as C,dn as b,ah as O,b2 as g,be as N,a2 as x,bk as K,_ as j,a as E,r as V,o as w,a8 as S,ao as M}from"./index-tq4TX8ps.js";import{U as A}from"./event-BwRzfsZt.js";import{p as L}from"./index-WcMWsiUt.js";import{e as P}from"./strings-DOQVhMSl.js";import{s as D}from"./token-DWNpOE8r.js";const H=k({extends:i,setup(e,t){const l=i.setup(e,t);delete l.selectOptionClick;const a=m().proxy;return y(()=>{l.select.states.cachedOptions.get(a.value)||l.select.onOptionCreate(a)}),f(()=>t.attrs.visible,e=>{y(()=>{l.states.visible=e})},{immediate:!0}),l},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function R(e){return e||0===e}function I(e){return C(e)&&e.length}function _(e){return C(e)?e:R(e)?[e]:[]}function z(e,t,l,a,s){for(let o=0;o<e.length;o++){const r=e[o];if(t(r,o,e,s))return a?a(r,o,e,s):r;{const e=l(r);if(I(e)){const s=z(e,t,l,a,r);if(s)return s}}}}function U(e,t,l,a){for(let s=0;s<e.length;s++){const o=e[s];t(o,s,e,a);const r=l(o);I(r)&&U(r,t,l,o)}}var q=k({props:{data:{type:Array,default:()=>[]}},setup(e){const t=x(D);return f(()=>e.data,()=>{var l;e.data.forEach(e=>{t.states.cachedOptions.has(e.value)||t.states.cachedOptions.set(e.value,e)});const a=(null==(l=t.selectRef)?void 0:l.querySelectorAll("input"))||[];K&&!Array.from(a).includes(document.activeElement)&&t.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const B=M(j(k({name:"ElTreeSelect",inheritAttrs:!1,props:c(n(n({},d.props),u.props),{cacheData:{type:Array,default:()=>[]}}),setup(e,t){const{slots:l,expose:r}=t,i=E(),k=E(),m=h(()=>e.nodeKey||e.valueKey||"value"),C=((e,{attrs:t,emit:l},{select:a,tree:s,key:o})=>{const r=p("tree-select");return f(()=>e.data,()=>{e.filterable&&y(()=>{var e,t;null==(t=s.value)||t.filter(null==(e=a.value)?void 0:e.states.inputValue)})},{flush:"post"}),c(n(n({},L(v(e),Object.keys(d.props))),t),{class:h(()=>t.class),style:h(()=>t.style),"onUpdate:modelValue":e=>l(A,e),valueKey:o,popperClass:h(()=>{const t=[r.e("popper")];return e.popperClass&&t.push(e.popperClass),t.join(" ")}),filterMethod:(t="")=>{var l;e.filterMethod?e.filterMethod(t):e.remoteMethod?e.remoteMethod(t):null==(l=s.value)||l.filter(t)}})})(e,t,{select:i,tree:k,key:m}),x=((e,{attrs:t,slots:l,emit:a},{select:s,tree:o,key:r})=>{f([()=>e.modelValue,o],()=>{e.showCheckbox&&y(()=>{const t=o.value;t&&!N(t.getCheckedKeys(),_(e.modelValue))&&t.setCheckedKeys(_(e.modelValue))})},{immediate:!0,deep:!0});const d=h(()=>n({value:r.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf"},e.props)),i=(e,t)=>{var l;const a=d.value[e];return g(a)?a(t,null==(l=o.value)?void 0:l.getNode(i("value",t))):t[a]},p=_(e.modelValue).map(t=>z(e.data||[],e=>i("value",e)===t,e=>i("children",e),(e,t,l,a)=>a&&i("value",a))).filter(e=>R(e)),k=h(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const t=[];return U(e.data.concat(e.cacheData),e=>{const l=i("value",e);t.push({value:l,currentLabel:i("label",e),isDisabled:i("disabled",e)})},e=>i("children",e)),t}),m=()=>{var e;return null==(e=o.value)?void 0:e.getCheckedKeys().filter(e=>{var t;const l=null==(t=o.value)?void 0:t.getNode(e);return!O(l)&&b(l.childNodes)})};return c(n(n({},L(v(e),Object.keys(u.props))),t),{nodeKey:r,expandOnClickNode:h(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:h(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(p):p),renderContent:(t,{node:a,data:s,store:o})=>t(H,{value:i("value",s),label:i("label",s),disabled:i("disabled",s),visible:a.visible},e.renderContent?()=>e.renderContent(t,{node:a,data:s,store:o}):l.default?()=>l.default({node:a,data:s,store:o}):void 0),filterNodeMethod:(t,l,a)=>e.filterNodeMethod?e.filterNodeMethod(t,l,a):!t||new RegExp(P(t),"i").test(i("label",l)||""),onNodeClick:(l,a,o)=>{var r,n,c,d;if(null==(r=t.onNodeClick)||r.call(t,l,a,o),!e.showCheckbox||!e.checkOnClickNode){if(e.showCheckbox||!e.checkStrictly&&!a.isLeaf)e.expandOnClickNode&&o.proxy.handleExpandIconClick();else if(!i("disabled",l)){const e=null==(n=s.value)?void 0:n.states.options.get(i("value",l));null==(c=s.value)||c.handleOptionSelect(e)}null==(d=s.value)||d.focus()}},onCheck:(l,r)=>{var n;if(!e.showCheckbox)return;const c=i("value",l),d={};U([o.value.store.root],e=>d[e.key]=e,e=>e.childNodes);const u=r.checkedKeys,p=e.multiple?_(e.modelValue).filter(e=>!(e in d)&&!u.includes(e)):[],f=p.concat(u);if(e.checkStrictly)a(A,e.multiple?f:f.includes(c)?c:void 0);else if(e.multiple){const e=m();a(A,p.concat(e))}else{const t=z([l],e=>!I(i("children",e))&&!i("disabled",e),e=>i("children",e)),s=t?i("value",t):void 0,o=R(e.modelValue)&&!!z([l],t=>i("value",t)===e.modelValue,e=>i("children",e));a(A,s===e.modelValue||o?void 0:s)}y(()=>{var a;const s=_(e.modelValue);o.value.setCheckedKeys(s),null==(a=t.onCheck)||a.call(t,l,{checkedKeys:o.value.getCheckedKeys(),checkedNodes:o.value.getCheckedNodes(),halfCheckedKeys:o.value.getHalfCheckedKeys(),halfCheckedNodes:o.value.getHalfCheckedNodes()})}),null==(n=s.value)||n.focus()},onNodeExpand:(l,s,r)=>{var n;null==(n=t.onNodeExpand)||n.call(t,l,s,r),y(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&s.checked){const t={},l=o.value.getCheckedKeys();U([o.value.store.root],e=>t[e.key]=e,e=>e.childNodes);const s=_(e.modelValue).filter(e=>!(e in t)&&!l.includes(e)),r=m();a(A,s.concat(r))}})},cacheOptions:k})})(e,t,{select:i,tree:k,key:m}),{cacheOptions:K}=x,j=((e,t)=>{var l={};for(var r in e)s.call(e,r)&&t.indexOf(r)<0&&(l[r]=e[r]);if(null!=e&&a)for(var r of a(e))t.indexOf(r)<0&&o.call(e,r)&&(l[r]=e[r]);return l})(x,["cacheOptions"]),M=V({});return r(M),w(()=>{Object.assign(M,c(n(n({},L(k.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"])),L(i.value,["focus","blur","selectedLabel"])),{treeRef:k.value,selectRef:i.value}))}),()=>S(d,V(c(n({},C),{ref:e=>i.value=e})),c(n({},l),{default:()=>[S(q,{data:K.value}),S(u,V(c(n({},j),{ref:e=>k.value=e})))]}))}}),[["__file","tree-select.vue"]]));export{B as E};
