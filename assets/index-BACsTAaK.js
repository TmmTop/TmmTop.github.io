var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(t,o,r)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[o]=r,n=(e,t)=>{for(var o in t||(t={}))i.call(t,o)&&s(e,o,t[o]);if(r)for(var o of r(t))a.call(t,o)&&s(e,o,t[o]);return e},l=(e,t,o)=>new Promise((r,i)=>{var a=e=>{try{n(o.next(e))}catch(t){i(t)}},s=e=>{try{n(o.throw(e))}catch(t){i(t)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,s);n((o=o.apply(e,t)).next())});import{d as p,v as m,a as u,F as d,e as c,f as j,p as g,u as h,I as v,z as f,J as y,k as b,y as _,l as x,m as w,n as S,N as C,a8 as O}from"./index-80d0f50K.js";import{E as P}from"./el-card-HhSFLCOH.js";import{_ as k}from"./index-C5QPwOKL.js";import{_ as T}from"./index-BWDmLw5_.js";import{E as z}from"./el-space-CyUbxB_u.js";import{E}from"./el-button-fxR6_Zjf.js";import{u as $}from"./useTable-DY_VsKAa.js";import{b as D,g as R,d as B}from"./role-BdOkOxvc.js";import{_ as F}from"./role-search.vue_vue_type_script_setup_true_lang-DKgoxft1.js";import{_ as I}from"./role-dialog.vue_vue_type_script_setup_true_lang-B4VRvMuC.js";import N from"./role-permission-dialog-ClsqcJMC.js";import{_ as U}from"./index.vue_vue_type_script_setup_true_lang-1dVEIasp.js";/* empty css                *//* empty css                *//* empty css              */import{u as A}from"./useAuth-CLpp_3ia.js";import{E as M}from"./index-DJ2az644.js";import{E as V}from"./index-DRfGKbK-.js";import{E as q}from"./index-DS3wKJiq.js";import"./el-pagination-nEZFsZEp.js";import"./el-option-1zm3uFw0.js";import"./index-CEhrLX_Z.js";import"./index-BLqz4iRr.js";import"./token-DWNpOE8r.js";import"./strings-Bkhypucl.js";import"./castArray-BIDSuBfr.js";import"./index-Bn1nBgds.js";import"./index-DF4pWoDg.js";import"./use-form-common-props-rfRIAI9b.js";import"./index-HP-ZmGVO.js";import"./event-BwRzfsZt.js";import"./index-C1O-KxyN.js";import"./aria-Dle50h-X.js";import"./scroll-CqYFcAjh.js";import"./debounce-PPvesCyO.js";import"./toNumber-Bai2bLmh.js";import"./_baseIteratee-CQPJyujW.js";import"./index-CMopGODU.js";import"./vnode-C3kCkgDK.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 */import"./el-table-column-BWrgyuTw.js";import"./_initCloneObject-DW4GtkWT.js";import"./isArrayLikeObject-CymPjir8.js";import"./raf-BvMqtkk0.js";import"./index-B5UyqyHu.js";/* empty css                    *//* empty css                   */import"./el-empty-4y9yHr4u.js";import"./formEnum-BLgiZVxV.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-popover-DiC7Ch-6.js";import"./el-dropdown-item-TZ_fPzGv.js";import"./refs-Cw5r5QN8.js";import"./index-D9I8kgnD.js";/* empty css                        */import"./index.vue_vue_type_script_setup_true_lang-DgRTW2yt.js";import"./vue-draggable-plus-COAXvOk1.js";import"./useTableColumns-Buoqz5xD.js";import"./index-BVqMl5-1.js";import"./el-form-item-fw-CxUqd.js";import"./_baseClone-DeaHpYmZ.js";import"./el-row-CWq4c_Ai.js";import"./el-col-DtVXklDZ.js";import"./el-radio-DDAcykNW.js";import"./tree-select-CaHcAz6B.js";import"./cloneDeep-BW92gViJ.js";import"./index-CUUo-P1Q.js";import"./index-Cu67jiIU.js";import"./clamp-yivlkT6q.js";import"./index-BJAVXn5l.js";import"./index-Bw7fD_Sj.js";import"./index-Ba3KIaDP.js";import"./index-B4tf9Pqh.js";import"./index-XoSS81ra.js";import"./validator-CVaYcbuU.js";import"./el-dialog-1gzNkj9H.js";import"./index-Dno4FvM4.js";import"./el-overlay-GydQvYeA.js";import"./index-CYUG33U5.js";/* empty css                        *//* empty css                *//* empty css                */const H={class:"role-page art-full-height"},J=p((K=n({},{name:"Role"}),t(K,o({__name:"index",setup(e){const{t:t}=m(),{hasAuth:o}=A(),r=u("add"),i=u(!1),a=u(!1);u(!1);const s=u({}),p=u([]),J=u({page:1,pageSize:10,roleName:void 0,roleCode:void 0,status:void 0}),K={0:{type:"info",text:"禁用"},1:{type:"success",text:"启用"}},{columns:L,columnChecks:W,data:X,loading:Y,pagination:Z,fetchData:G,searchParams:Q,resetSearchParams:ee,handleSizeChange:te,handleCurrentChange:oe,refreshData:re}=$({core:{apiFn:R,apiParams:n({page:1,pageSize:10},J.value),paginationKey:{current:"page",size:"pageSize"},columnsFactory:()=>[{type:"selection"},{type:"index",width:60,label:"序号"},{prop:"role_name",label:"角色名称",width:150,showOverflowTooltip:!0},{prop:"role_code",label:"角色编码",width:150,showOverflowTooltip:!0},{prop:"description",label:"角色描述",minWidth:150,showOverflowTooltip:!0},{prop:"status",label:"状态",width:80,formatter:e=>{const t=(o=e.status,K[o]||{type:"info",text:"未知"});var o;return O(V,{type:t.type},()=>t.text)}},{prop:"sort",label:"排序",width:80},{prop:"create_time",label:"创建时间",width:180,sortable:!0,showOverflowTooltip:!0,formatter:e=>(e=>{if(!e)return"-";const t=new Date(e);return isNaN(t.getTime())?"-":`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`})(e.create_time)},{prop:"operation",label:"操作",width:240,fixed:"right",formatter:e=>O("div",[O(q,{content:t("menus.system.menuPermissionBtn"),placement:"top"},()=>O(U,{type:"view",icon:"ri:shield-keyhole-line",onClick:()=>se(e),style:o("role:menu")?"":"display: none"})),O(q,{content:t("menus.system.edit"),placement:"top"},()=>O(U,{type:"edit",onClick:()=>ae("edit",e),style:o("role:update")?"":"display: none"})),O(q,{content:t("menus.system.delete"),placement:"top"},()=>O(U,{type:"delete",onClick:()=>le(e),style:o("role:delete")?"":"display: none"}))])}]}}),ie=e=>{Object.assign(Q,e),G()},ae=(e,t)=>{r.value=e,s.value=t||{},S(()=>{i.value=!0})},se=e=>{s.value=e,S(()=>{a.value=!0})},ne=()=>{if(0===p.value.length)return void C.warning("请选择要删除的角色");const e=p.value.map(e=>e.role_name).join("、");M.confirm(`确定要删除选中的 ${p.value.length} 个角色吗？\n${e}`,"批量删除角色",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>l(null,null,function*(){try{const e=p.value.map(e=>e.id);yield D(e),C.success("批量删除成功"),p.value=[],re()}catch(e){C.error(e.message||"批量删除失败")}})).catch(()=>{})},le=e=>{M.confirm(`确定要删除角色"${e.role_name}"吗？`,"删除角色",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>l(null,null,function*(){try{yield B(e.id),C.success("删除成功"),re()}catch(t){C.error(t.message||"删除失败")}})).catch(()=>{})},pe=()=>l(null,null,function*(){try{i.value=!1,s.value={},re()}catch(e){}}),me=e=>{p.value=e};return(e,t)=>{const n=E,l=z,m=T,u=k,S=P,C=d("ripple");return j(),c("div",H,[g(F,{modelValue:h(J),"onUpdate:modelValue":t[0]||(t[0]=e=>v(J)?J.value=e:null),onSearch:ie,onReset:h(ee),"search-auth":"role:query","reset-auth":"role:query"},null,8,["modelValue","onReset"]),g(S,{class:"art-table-card",shadow:"never"},{default:f(()=>[g(m,{columns:h(W),"onUpdate:columns":t[2]||(t[2]=e=>v(W)?W.value=e:null),loading:h(Y),onRefresh:h(re),"search-auth":"role:query","refresh-auth":"role:query"},{left:f(()=>[g(l,{wrap:""},{default:f(()=>[h(o)("role:add")?y((j(),_(n,{key:0,onClick:t[1]||(t[1]=e=>ae("add"))},{default:f(()=>[...t[5]||(t[5]=[x("新增角色",-1)])]),_:1})),[[C]]):b("",!0),h(o)("role:batchDelete")?y((j(),_(n,{key:1,onClick:ne,disabled:0===h(p).length,type:"danger"},{default:f(()=>[x(" 批量删除("+w(h(p).length)+") ",1)]),_:1},8,["disabled"])),[[C]]):b("",!0)]),_:1})]),_:1},8,["columns","loading","onRefresh"]),g(u,{loading:h(Y),data:h(X),columns:h(L),pagination:h(Z),onSelectionChange:me,"onPagination:sizeChange":h(te),"onPagination:currentChange":h(oe)},null,8,["loading","data","columns","pagination","onPagination:sizeChange","onPagination:currentChange"]),g(I,{visible:h(i),"onUpdate:visible":t[3]||(t[3]=e=>v(i)?i.value=e:null),type:h(r),"role-data":h(s),onSubmit:pe},null,8,["visible","type","role-data"]),g(N,{visible:h(a),"onUpdate:visible":t[4]||(t[4]=e=>v(a)?a.value=e:null),"role-data":h(s),onSuccess:h(re)},null,8,["visible","role-data","onSuccess"])]),_:1})])}}}))));var K;export{J as default};
